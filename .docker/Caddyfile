(cors) {
  @cors_preflight method OPTIONS
  @cors header Origin {args.0}

  handle @cors_preflight {
    header Access-Control-Allow-Origin "{args.0}"
    header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE"
    header Access-Control-Allow-Headers "Content-Type"
    header Access-Control-Max-Age "3600"
    respond "" 204
  }

  handle @cors {
    header Access-Control-Allow-Origin "{args.0}"
    header Access-Control-Expose-Headers "Link"
  }
}

# https://caddy.community/t/v2-serve-rails-application-with-static-assets/9006/2
# rails caddy

https://ngotenders.in {
    root * /data/ngotenders.in/public
    encode zstd gzip
    file_server

    @notStatic {
	    not file
    }

    reverse_proxy @notStatic http://rails:3000
    # header Access-Control-Allow-Methods "POST, GET, OPTIONS"
	# @options {
	# 	method OPTIONS
	# }
	# respond @options 204
	# import cors https://assets.ngotenders.in
}

# https://assets.ngotenders.in {
#     root * /data/ngotenders.in/public
# 	  file_server
#     # correct
#     import cors https://ngotenders.in
#     encode zstd gzip
# }

